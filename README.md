# FaceFix Pro - 人脸五官修复工具

这是一个基于 Web 的智能人脸五官修复工具，利用 OpenCV 的 Delaunay 三角剖分和泊松融合技术，实现从源图片到目标图片的五官特征精确迁移。

## 项目结构

```
.
├── app.py                 # Flask 后端主程序
├── requirements.txt       # Python 依赖列表
├── README.md              # 项目说明文档
├── templates/             # HTML 模板目录
│   └── index.html         # 前端界面（包含 CSS/JS）
└── static/                # 静态文件目录
    └── uploads/           # 上传图片和处理结果的临时存储目录
```

## 功能特点

*   **专业级界面**：深色主题，沉浸式操作体验。
*   **交互式标记**：支持在 Web 端对两张图片进行特征点标记。
*   **智能变形**：基于特征点进行仿射变换，确保形状匹配。
*   **无缝融合**：使用泊松融合技术，使移植的五官与背景自然过渡。

## 安装与运行

1.  **安装依赖**：
    ```bash
    pip install -r requirements.txt
    ```

2.  **运行程序**：
    ```bash
    python app.py
    ```

3.  **访问工具**：
    打开浏览器访问 `http://127.0.0.1:5000`

## 使用方法

1.  点击左侧区域上传**目标图片**（被遮挡的人脸）。
2.  点击右侧区域上传**源图片**（提供五官素材的清晰人脸）。
3.  在两张图片上依次点击，标记对应的特征点（例如：左嘴角对左嘴角）。
4.  至少标记 3 对点后，点击左侧面板的“开始处理”按钮。
5.  在弹出的结果窗口中预览或下载修复后的图片。


# 参考线功能

根据手动标注点的位置生成参考线

- 纵向参考线：中轴线位于图像正中，若给出任意眼角点、左耳点、右耳点其中一点，则可以通过与中轴线的距离，计算出眼宽、眼距的信息把脸部分为5等分。 推算逻辑：
           + 如果已知内眼角，则：h=内眼角到中轴线的距离，两眼内角线=中轴线±h；两眼外角线=中轴线±3h；左右耳线=中轴线±5h。
           + 如果已知外眼角，则：h=外眼角到中轴线的距离/3，两眼内角线=中轴线±h；两眼外角线=中轴线±3h；左右耳线=中轴线±5h。
           + 如果已知左/右耳，则：h=耳朵到中轴线距离/5，两眼内角线=中轴线±h；两眼外角线=中轴线±3h；左右耳线=中轴线±5h。
                       
- 水平参考线：至少标注 左/右内眼角、上庭顶、眉心、鼻下、唇中、下颌 中的两个点，才能确定水平参考线的位置，推算逻辑：
          + 设则内眼角到眉心的距离为h，则内眼角到鼻下的距离=2h，鼻下到唇中的距离=h，鼻下到下颌的距离=3h，眉心到上庭顶的距离=3h，根据该比例，任知其中两点均可以推算出其他点。


**三庭五眼参考线、辅助线功能：**

- 当用户标记左眼内角或有眼内角时，眼内角到中轴线的距离为L，在中轴线向右L处作垂直虚线：右眼内角线；中轴线向右3L处作垂直虚线：右眼外角线；在中轴线向右5L位置作垂直虚线：右耳线。根据对称性，左脸同理。得到左眼内角线、左眼外角线、左耳线。

- 鼻下距离眉心=鼻下距离下颌，当用户标记鼻下、下颌、眉心三者中任意两点时，可推出第三点位置。
  
- 眼内角的垂直位置位于眉心至鼻下距离的的1/3处
  
- 唇中位于鼻下距离下颌的1/3距离处。

- 左眼外角线与眼内角线交点为左眼外角

- 右眼外角线与眼内角线交点为右眼外角

- 眉心线与左耳线交点为左耳点

- 眉心线与右耳线交点为右耳点。

- 左眼内角线、鼻底线交点为左鼻翼点

- 右眼内角线、鼻底线交点为右鼻翼点

- 过眉心、左鼻翼做一条直线为辅助线1，辅助线1与唇中线的交点为左嘴角点。

- 过眉心、右鼻翼做一条直线为辅助线2，辅助线1与唇中线的交点为右嘴角点。

- 过左耳点、左鼻翼左辅助线3；过右耳点、右鼻翼做辅助线4。

- 辅助线3和辅助线4的交点为上唇顶点

- 辅助线1和辅助线4的交点为下颌左点

- 辅助线2和辅助线3的交点为下颌右点